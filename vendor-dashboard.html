<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="داشبورد فروشنده آرمان - TestSit">
    <title>داشبورد فروشنده - TestSit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
    <link rel="manifest" href="/manifest.json">
</head>
<body>
    <div class="container mx-auto p-4">
        <div class="flex justify-end mb-4">
            <button id="themeToggle" class="btn">تغییر تم</button>
        </div>
        <header class="rounded-lg p-6 mb-6 flex items-center justify-between">
            <div class="flex items-center">
                <img src="/assets/images/logo-testsit.png" alt="لوگو TestSit" class="logo">
                <h1 class="text-3xl font-bold">TestSit - داشبورد فروشنده</h1>
            </div>
            <a href="/vendor-armoon.html" class="btn">بازگشت به فروشگاه</a>
        </header>
        <section class="card p-6">
            <h2 class="text-xl font-semibold">افزودن محصول جدید</h2>
            <form id="addProductForm" class="mt-4">
                <input type="text" name="name" placeholder="نام محصول" class="p-2 border rounded-lg w-full mb-2">
                <input type="number" name="price" placeholder="قیمت (تومان)" class="p-2 border rounded-lg w-full mb-2">
                <input type="number" name="stock" placeholder="موجودی" class="p-2 border rounded-lg w-full mb-2">
                <select name="category" class="p-2 border rounded-lg w-full mb-2">
                    <option value="tamper">تمپر</option>
                    <option value="cleaning">ابزار تمیزکاری</option>
                    <option value="accessory">لوازم جانبی</option>
                </select>
                <button type="submit" class="btn">افزودن محصول</button>
            </form>
        </section>
        <section class="card p-6 mt-6">
            <h2 class="text-xl font-semibold">مدیریت نظرات</h2>
            <div id="vendorComments" class="mt-4"></div>
        </section>
        <footer class="rounded-lg p-6 mt-6">
            <p>تمامی حقوق این وب‌سایت محفوظ است. © ۱۴۰۴ TestSit</p>
            <div class="mt-4 flex justify-center gap-4">
                <a href="/about.html">درباره ما</a>
                <a href="/contact.html">تماس با ما</a>
                <a href="/terms.html">شرایط و قوانین</a>
            </div>
        </footer>
    </div>
    <div id="toast" class="toast hidden"></div>
    <script src="/service-worker.js"></script>
    <script>
        function showToast(message, type) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('hidden', 'success', 'error');
            toast.classList.add(type);
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        async function renderVendorComments() {
            const commentsList = document.getElementById('vendorComments');
            try {
                const response = await axios.get('/api.php?action=comments&product_id=1');
                commentsList.innerHTML = response.data.map(c => `
                    <div class="border-b py-2">
                        <p class="text-sm">${c.user}: ${c.text} (${'⭐'.repeat(c.rating)})</p>
                        <textarea class="p-2 border rounded-lg w-full mb-2" placeholder="پاسخ شما"></textarea>
                        <button class="btn reply-comment" data-id="${c.id}">ارسال پاسخ</button>
                    </div>
                `).join('');
                document.querySelectorAll('.reply-comment').forEach(button => {
                    button.addEventListener('click', async () => {
                        const commentId = button.dataset.id;
                        const reply = button.previousElementSibling.value;
                        try {
                            await axios.post('/api.php', `action=reply_comment&comment_id=${commentId}&reply=${encodeURIComponent(reply)}`);
                            showToast('پاسخ ثبت شد!', 'success');
                            renderVendorComments();
                        } catch (err) {
                            showToast('خطا در ثبت پاسخ', 'error');
                        }
                    });
                });
            } catch (err) {
                showToast('خطا در بارگذاری نظرات', 'error');
            }
        }

        document.getElementById('addProductForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const name = form.querySelector('[name="name"]').value;
            const price = form.querySelector('[name="price"]').value;
            const stock = form.querySelector('[name="stock"]').value;
            const category = form.querySelector('[name="category"]').value;
            try {
                await axios.post('/api.php', `action=add_product&name=${encodeURIComponent(name)}&price=${price}&stock=${stock}&category=${category}`);
                showToast('محصول اضافه شد!', 'success');
                form.reset();
            } catch (err) {
                showToast('خطا در افزودن محصول', 'error');
            }
        });

        document.getElementById('themeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark');
            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        });
        if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');

        renderVendorComments();
    </script>
</body>
</html>
